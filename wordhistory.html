<!DOCTYPE html> 
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÇ‡∏•‡∏Å ‚Äì Timeline (Search + Pagination + WikiThumb)</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- PapaParse (CSV Parser) -->
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  :root{
    --bg:#f7fafc; --paper:#ffffff; --ink:#0f172a; --muted:#475569; --line:#e5e7eb;
    --brand:#1d4ed8; --brand-2:#0ea5e9;
    --radius:16px; --shadow:0 18px 40px -22px rgba(2,8,23,.25);
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:"Sarabun",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--ink)}

  header{
    position:sticky; top:0; z-index:50;
    background:linear-gradient(90deg, var(--brand), var(--brand-2));
    color:#fff; padding:14px 16px; box-shadow:0 10px 30px -20px rgba(0,0,0,.4)
  }
  header .wrap{
    max-width:980px; margin:auto; display:flex; gap:12px; align-items:center; flex-wrap:wrap
  }
  .title{font-weight:700; font-size:1.25rem; letter-spacing:.2px}
  .search{
    margin-left:auto; display:flex; align-items:center; gap:8px;
    background:rgba(255,255,255,.15); padding:6px 10px; border-radius:999px; backdrop-filter: blur(6px); width:min(520px,100%)
  }
  .search input{border:none; outline:none; background:transparent; color:#fff; width:100%}
  .search ::placeholder{color:rgba(255,255,255,.85)}

  .layout{ max-width:980px; margin:12px auto; padding:0 16px; }
  #timeline{
    background:var(--paper); border:1px solid var(--line); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:14px
  }
  .event-card{
    display:grid; grid-template-columns: 92px 1fr; gap:12px;
    border:1px solid var(--line); border-radius:14px; padding:10px; margin:10px 0;
    background:#fff; transition:transform .12s ease, box-shadow .12s ease; cursor:pointer
  }
  .event-card:hover{ transform: translateY(-2px); box-shadow:0 10px 30px -18px rgba(2,8,23,.18) }

  /* ‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÄ‡∏•‡πá‡∏Å‡∏û‡∏≠‡∏î‡∏µ + ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏†‡∏≤‡∏û */
  .thumb{
    width:100%; height:68px; border-radius:10px; background:#f1f5f9; border:1px solid var(--line);
    object-fit:cover; display:block;
  }

  .meta{font-size:.84rem; color:var(--muted)}
  .event-title{margin:2px 0; font-weight:700; color:#1d4ed8}
  .tags{display:flex; flex-wrap:wrap; gap:6px; margin-top:6px}
  .tag{font-size:.75rem; padding:4px 8px; border-radius:999px; background:#f8fafc; border:1px solid var(--line); color:#334155}

  /* Pager */
  .pager{
    display:flex; justify-content:center; align-items:center; gap:8px; margin-top:8px; flex-wrap:wrap
  }
  .pager .btn{
    font-size:.9rem; padding:6px 10px; border-radius:10px; border:1px solid var(--line);
    background:#fff; color:#0f172a; cursor:pointer
  }
  .pager .btn[disabled]{opacity:.5; cursor:not-allowed}
  .pager .info{font-size:.9rem; color:#475569}

  /* Modal */
  dialog{
    width:min(860px, 92vw); border:none; border-radius:18px; padding:0; overflow:hidden;
    box-shadow:0 30px 70px -20px rgba(2,8,23,.45)
  }
  .modal-head{display:flex; gap:12px; align-items:center; padding:14px 16px; background:#0f172a; color:#fff}
  .modal-head h3{margin:0; font-size:1.15rem}
  .close-btn{margin-left:auto; background:#fff; color:#0f172a; border:none; border-radius:10px; padding:6px 10px; font-weight:700; cursor:pointer}

  .modal-body{
    display:grid; grid-template-columns: 240px 1fr; gap:16px; padding:16px; background:#fff
  }
  .modal-body img{width:100%; border-radius:14px; object-fit:cover; background:#f8fafc; border:1px solid var(--line); height:160px}
  .modal-section h4{margin:.2rem 0 .4rem; color:#0f172a}
  .modal-meta{font-size:.92rem; color:#475569}
  .modal-summary{line-height:1.7; font-size:1rem; color:#0f172a; white-space:pre-wrap}

  .modal-footer{
    padding:12px 16px 16px; background:#fff; border-top:1px solid var(--line)
  }
  .btn-primary{
    display:inline-flex; justify-content:center; align-items:center; gap:8px;
    border:1px solid var(--line); background:#0ea5e9; color:#fff; border-radius:12px; padding:12px 14px; cursor:pointer; font-weight:700; text-decoration:none; width:100%
  }

  /* Responsive rules for phones */
  @media (max-width: 980px){
    .event-card{grid-template-columns: 86px 1fr}
  }
  @media (max-width: 560px){
    header .wrap{gap:8px}
    .title{font-size:1.05rem}
    .search{width:100%; order:2; margin-left:0; justify-content:space-between}
    .event-card{grid-template-columns: 80px 1fr}
    .thumb{height:64px}
    .modal-body{grid-template-columns:1fr}
    .modal-body img{height:180px}
  }
</style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="title">üåç ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÇ‡∏•‡∏Å ‚Äì World History</div>
    <div class="search">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
      <input id="q" type="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® / ‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå / ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• / ‡∏Ñ.‡∏®."/>
    </div>
  </div>
</header>

<div class="layout">
  <section id="timeline" aria-label="timeline events"></section>
  <div id="pager" class="pager" aria-label="pagination"></div>
</div>

<!-- Modal ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î -->
<dialog id="detailModal">
  <div class="modal-head">
    <h3 id="mTitle">Title</h3>
    <button class="close-btn" onclick="modal.close()">‡∏õ‡∏¥‡∏î</button>
  </div>

  <div class="modal-body">
    <img id="mImg" alt="">
    <div class="modal-section">
      <div class="modal-meta" id="mMeta"></div>
      <h4>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏¢‡πà‡∏≠</h4>
      <div id="mSummary" class="modal-summary"></div>
    </div>
  </div>

  <div class="modal-footer">
    <a class="btn-primary" id="mReadFull" target="_blank" rel="noopener">‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡πá‡∏°</a>
  </div>
</dialog>

<script>
/* ====== 1) ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV ====== */
const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRHCUSbSUka5matIOmUxIuaWAYcHtCa8rNcfbWTQcpTL2zIH2PYKFOwQFOZtEo-Js52SMzRDwaW1k5u/pub?output=csv"; // <<<<< ‡πÉ‡∏™‡πà URL CSV ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
// ‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á: id,title,year,era,continent,country,image,summary,category,source_url

/* ====== 1.1 Demo CSV (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà URL) ====== */
const DEMO_CSV = `id,title,year,era,continent,country,image,summary,category,source_url
1,‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏µ‡∏£‡∏∞‡∏°‡∏¥‡∏î‡∏Å‡∏¥‡∏ã‡∏≤,-2560,‡πÇ‡∏ö‡∏£‡∏≤‡∏ì,‡πÅ‡∏≠‡∏ü‡∏£‡∏¥‡∏Å‡∏≤,‡∏≠‡∏µ‡∏¢‡∏¥‡∏õ‡∏ï‡πå,https://upload.wikimedia.org/wikipedia/commons/e/e3/Kheops-Pyramid.jpg,‡∏û‡∏µ‡∏£‡∏∞‡∏°‡∏¥‡∏î‡∏¢‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏∏‡∏™‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡πÇ‡∏£‡∏´‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á,‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡πå,https://th.wikipedia.org/wiki/%E0%B8%9E%E0%B8%B5%E0%B8%A3%E0%B8%B0%E0%B8%A1%E0%B8%B4%E0%B8%94%E0%B9%83%E0%B8%AB%E0%B8%8D%E0%B9%88%E0%B8%81%E0%B8%B4%E0%B8%8B%E0%B8%B2
2,‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏°‡∏™‡∏•‡∏≤‡∏¢‡πÇ‡∏£‡∏°‡∏±‡∏ô‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å,476,‡∏Å‡∏•‡∏≤‡∏á,‡∏¢‡∏∏‡πÇ‡∏£‡∏õ,‡∏≠‡∏¥‡∏ï‡∏≤‡∏•‡∏µ,https://upload.wikimedia.org/wikipedia/commons/9/97/RomanEmpire_117AD.png,‡∏à‡∏∏‡∏î‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏à‡∏±‡∏Å‡∏£‡∏ß‡∏£‡∏£‡∏î‡∏¥‡πÇ‡∏£‡∏°‡∏±‡∏ô‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å ‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡∏¢‡∏∏‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á‡∏¢‡∏∏‡πÇ‡∏£‡∏õ,‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°,https://th.wikipedia.org/wiki/%E0%B8%88%E0%B8%B1%E0%B8%81%E0%B8%A3%E0%B8%A7%E0%B8%A3%E0%B8%94%E0%B8%B4%E0%B9%82%E0%B8%A3%E0%B8%A1%E0%B8%B1%E0%B8%99
3,‡πÇ‡∏Ñ‡∏•‡∏±‡∏°‡∏ö‡∏±‡∏™‡∏û‡∏ö‡πÇ‡∏•‡∏Å‡πÉ‡∏´‡∏°‡πà,1492,‡πÄ‡∏£‡∏≠‡πÄ‡∏ô‡∏™‡∏ã‡∏≠‡∏á‡∏™‡πå,‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤‡πÄ‡∏´‡∏ô‡∏∑‡∏≠,‡∏ö‡∏≤‡∏Æ‡∏≤‡∏°‡∏≤‡∏™,https://upload.wikimedia.org/wikipedia/commons/0/07/Columbus_Taking_Possession.jpg,‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏ô‡∏≥‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏≠‡∏≤‡∏ì‡∏≤‡∏ô‡∏¥‡∏Ñ‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏•‡∏Å‡πÄ‡∏Å‡πà‡∏≤-‡πÇ‡∏•‡∏Å‡πÉ‡∏´‡∏°‡πà,‡∏™‡∏≥‡∏£‡∏ß‡∏à,https://th.wikipedia.org/wiki/%E0%B9%82%E0%B8%84%E0%B8%A5%E0%B8%B1%E0%B8%A1%E0%B8%9A%E0%B8%B1%E0%B8%AA
4,‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°,1760,‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà,‡∏¢‡∏∏‡πÇ‡∏£‡∏õ,‡∏™‡∏´‡∏£‡∏≤‡∏ä‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£,https://upload.wikimedia.org/wikipedia/commons/3/3a/Powerloom_weaving_mill.jpg,‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ ‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°,‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à,https://th.wikipedia.org/wiki/%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B8%9B%E0%B8%8F%E0%B8%B4%E0%B8%A7%E0%B8%B1%E0%B8%95%E0%B8%B4%E0%B8%AD%E0%B8%B8%E0%B8%95%E0%B8%AA%E0%B8%B2%E0%B8%AB%E0%B8%81%E0%B8%A3%E0%B8%A3%E0%B8%A1
5,‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏≠‡∏Å‡∏£‡∏≤‡∏ä‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏Ø,1776,‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà,‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤‡πÄ‡∏´‡∏ô‡∏∑‡∏≠,‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤,https://upload.wikimedia.org/wikipedia/commons/1/1f/Declaration_independence.jpg,‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡∏ä‡∏ô‡∏¢‡∏∏‡∏Ñ‡πÉ‡∏´‡∏°‡πà,‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á,https://th.wikipedia.org/wiki/%E0%B8%9B%E0%B8%A3%E0%B8%B0%E0%B8%81%E0%B8%B2%E0%B8%A8%E0%B9%80%E0%B8%AD%E0%B8%81%E0%B8%A3%E0%B8%B2%E0%B8%8A%E0%B8%AA%E0%B8%AB%E0%B8%A3%E0%B8%B1%E0%B8%90
6,‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡πÇ‡∏•‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2,1939,‡∏£‡πà‡∏ß‡∏°‡∏™‡∏°‡∏±‡∏¢,‡∏¢‡∏∏‡πÇ‡∏£‡∏õ,‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®,https://upload.wikimedia.org/wikipedia/commons/1/1e/WWII_collage.png,‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏•‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à ‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÇ‡∏•‡∏Å,‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°,https://th.wikipedia.org/wiki/%E0%B8%AA%E0%B8%87%E0%B8%84%E0%B8%A3%E0%B8%B2%E0%B8%A1%E0%B9%82%E0%B8%A5%E0%B8%81%E0%B8%84%E0%B8%A3%E0%B8%B1%E0%B9%89%E0%B8%87%E0%B8%97%E0%B8%B5%E0%B9%88%E0%B8%AA%E0%B8%AD%E0%B8%87
7,‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ß‡∏±‡∏ï‡∏¥‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™,1789,‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà,‡∏¢‡∏∏‡πÇ‡∏£‡∏õ,‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™,https://upload.wikimedia.org/wikipedia/commons/1/1f/Prise_de_la_Bastille.jpg,‡∏´‡∏•‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏°‡∏Ñ‡πà‡∏≤‡∏ô‡∏¥‡∏¢‡∏°‡πÄ‡∏™‡∏£‡∏µ‡∏†‡∏≤‡∏û ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏°‡∏≠‡∏†‡∏≤‡∏Ñ ‡∏†‡∏£‡∏≤‡∏î‡∏£‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏∞‡∏ö‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏¢‡∏∏‡πÇ‡∏£‡∏õ,‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á,https://th.wikipedia.org/wiki/%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B8%9B%E0%B8%8F%E0%B8%B4%E0%B8%A7%E0%B8%B1%E0%B8%95%E0%B8%B4%E0%B8%9D%E0%B8%A3%E0%B8%B1%E0%B8%87%E0%B9%80%E0%B8%A8%E0%B8%AA
8,‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏õ‡∏ô‡∏≤‡∏™‡∏¢‡∏≤‡∏°‡∏™‡∏°‡∏±‡∏¢‡∏£‡∏±‡∏ï‡∏ô‡πÇ‡∏Å‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡πå,1782,‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà,‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢,‡πÑ‡∏ó‡∏¢,https://upload.wikimedia.org/wikipedia/commons/9/96/Grand_Palace_Bangkok.jpg,‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÑ‡∏ó‡∏¢‡∏™‡∏π‡πà‡∏Å‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏ï‡∏ô‡πÇ‡∏Å‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏£‡∏π‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà,‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÉ‡∏ï‡πâ,https://th.wikipedia.org/wiki/%E0%B8%A3%E0%B8%B1%E0%B8%95%E0%B8%99%E0%B9%82%E0%B8%81%E0%B8%AA%E0%B8%B4%E0%B8%99%E0%B8%97%E0%B8%A3%E0%B9%8C
`;

let RAW = [];
let CURRENT = []; // ‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏£‡∏≠‡∏á
let page = 1;
const pageSize = 20;

/* ====== ‡∏Ç‡∏ô‡∏≤‡∏î thumbnail ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏£‡∏≠‡∏ö) ====== */
const THUMB_WIDTH = 240; // px

/* ====== Placeholder data URI ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ====== */
const PLACEHOLDER =
  'data:image/svg+xml;utf8,' +
  encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="240" height="160">
    <rect width="100%" height="100%" fill="#e5e7eb"/>
    <g fill="#94a3b8" font-family="sans-serif" font-size="14">
      <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle">no image</text>
    </g>
  </svg>`);

/* ====== 2) ‡πÇ‡∏´‡∏•‡∏î CSV ====== */
async function loadCSV(){
  if(SHEET_CSV_URL){
    return new Promise((resolve, reject)=>{
      Papa.parse(SHEET_CSV_URL, {
        download:true, header:true, skipEmptyLines:true,
        complete: (res)=> resolve(res.data),
        error: reject
      });
    });
  }else{
    return new Promise((resolve)=> {
      const res = Papa.parse(DEMO_CSV, {header:true, skipEmptyLines:true});
      resolve(res.data);
    });
  }
}

/* ====== 3) ‡πÅ‡∏õ‡∏•‡∏á URL Wikipedia ‚Üí thumbnail ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å ====== */
function toWikiThumb(url, width = THUMB_WIDTH){
  if(!url) return url;
  try{
    const u = new URL(url);
    if(u.hostname !== 'upload.wikimedia.org') return url; // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Wikimedia ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ú‡πà‡∏≤‡∏ô
    const parts = u.pathname.split('/');
    const idx = parts.indexOf('commons');
    if(idx === -1) return url;
    if(parts[idx+1] === 'thumb'){
      const fileName = parts[parts.length-1].replace(/^\d+px-/, '');
      parts[parts.length-1] = `${width}px-${fileName}`;
      u.pathname = parts.join('/');
      return u.toString();
    }else{
      const fileName = parts[parts.length-1];
      const head = parts.slice(0, idx+1);
      const tail = parts.slice(idx+1);
      const newPath = [...head, 'thumb', ...tail, `${width}px-${fileName}`].join('/');
      u.pathname = newPath;
      return u.toString();
    }
  }catch{
    return url;
  }
}

/* ====== 4) ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ====== */
function applyFilters(){
  const q = document.getElementById('q').value.trim().toLowerCase();
  CURRENT = RAW.filter(r=>{
    const hay = `${r.title||""} ${r.summary||""} ${r.country||""} ${r.continent||""} ${r.era||""} ${r.category||""} ${r.year||""}`.toLowerCase();
    return q==="" ? true : hay.includes(q);
  });
  page = 1;          // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà
  renderList();
}

/* ====== 5) ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå + ‡πÄ‡∏û‡∏à ====== */
function renderList(){
  const host = document.getElementById('timeline');
  host.innerHTML = "";

  if(CURRENT.length===0){
    host.innerHTML = `<div style="padding:16px;color:#64748b">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</div>`;
    document.getElementById('pager').innerHTML = "";
    return;
  }

  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏µ (‡∏ô‡πâ‡∏≠‡∏¢ -> ‡∏°‡∏≤‡∏Å)
  const rows = [...CURRENT].sort((a,b)=> Number(a.year)-Number(b.year));
  const totalPages = Math.max(1, Math.ceil(rows.length / pageSize));
  page = Math.min(page, totalPages);

  const start = (page-1)*pageSize;
  const end   = start + pageSize;
  const slice = rows.slice(start, end);

  slice.forEach(r=>{
    const card = document.createElement('article');
    card.className = 'event-card';

    const imgUrl = toWikiThumb(r.image || '') || r.image || PLACEHOLDER;

    const img = document.createElement('img');
    img.className = 'thumb';
    img.loading = 'lazy';
    img.decoding = 'async';
    img.setAttribute('referrerpolicy','no-referrer');
    img.alt = r.title || "";
    img.src = imgUrl || PLACEHOLDER;
    img.onerror = ()=>{ img.src = PLACEHOLDER; };

    const right = document.createElement('div');
    right.innerHTML = `
      <div class="meta">${r.year||""} ¬∑ ${r.country||""} ${r.continent?`(${r.continent})`:""}</div>
      <div class="event-title">${r.title||""}</div>
      <div class="meta">${(r.summary||"").slice(0,110)}${(r.summary||"").length>110?"‚Ä¶":""}</div>
      <div class="tags">
        ${r.era? `<span class="tag">‡∏¢‡∏∏‡∏Ñ: ${r.era}</span>`:""}
      </div>
    `;

    card.append(img, right);
    card.addEventListener('click', ()=> openModal(r));
    host.append(card);
  });

  renderPager(totalPages, rows.length);
}

function renderPager(totalPages, totalItems){
  const pager = document.getElementById('pager');
  pager.innerHTML = "";

  const btnPrev = document.createElement('button');
  btnPrev.className = 'btn';
  btnPrev.textContent = '‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö';
  btnPrev.disabled = (page<=1);
  btnPrev.onclick = ()=>{ page = Math.max(1, page-1); renderList(); };

  const info = document.createElement('span');
  const startItem = (page-1)*pageSize + 1;
  const endItem = Math.min(page*pageSize, totalItems);
  info.className = 'info';
  info.textContent = `${startItem}-${endItem} / ${totalItems}`;

  const btnNext = document.createElement('button');
  btnNext.className = 'btn';
  btnNext.textContent = '‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
  btnNext.disabled = (page>=totalPages);
  btnNext.onclick = ()=>{ page = Math.min(totalPages, page+1); renderList(); };

  pager.append(btnPrev, info, btnNext);
}

/* ====== 6) ‡πÇ‡∏°‡∏î‡∏±‡∏•‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î + ‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏Å‡∏£‡∏≠‡∏• ====== */
const modal = document.getElementById('detailModal');

function lockScroll(){
  const y = window.scrollY || document.documentElement.scrollTop;
  document.body.dataset.scrollY = y;
  document.body.style.position = 'fixed';
  document.body.style.top = `-${y}px`;
  document.body.style.left = '0';
  document.body.style.right = '0';
  document.body.style.width = '100%';
  document.body.style.overflow = 'hidden';
}
function unlockScroll(){
  const y = parseInt(document.body.dataset.scrollY || '0', 10);
  document.body.style.position = '';
  document.body.style.top = '';
  document.body.style.left = '';
  document.body.style.right = '';
  document.body.style.width = '';
  document.body.style.overflow = '';
  delete document.body.dataset.scrollY;
  window.scrollTo(0, y);
}

function openModal(r){
  const mImg = document.getElementById('mImg');
  const fullOrThumb = toWikiThumb(r.image || '', 640) || r.image || PLACEHOLDER;
  mImg.setAttribute('referrerpolicy','no-referrer');
  mImg.alt = r.title||"";
  mImg.src = fullOrThumb || PLACEHOLDER;
  mImg.onerror = ()=>{ mImg.src = PLACEHOLDER; };

  document.getElementById('mTitle').textContent = r.title||"";
  document.getElementById('mMeta').textContent = `${r.year||""} ¬∑ ${r.country||""} ${r.continent?`(${r.continent})`:""} ¬∑ ‡∏¢‡∏∏‡∏Ñ ${r.era||""}`;
  document.getElementById('mSummary').textContent = r.summary||"";

  const readBtn = document.getElementById('mReadFull');
  if(r.source_url){
    readBtn.href = r.source_url;
    readBtn.style.display = 'inline-flex';
  }else{
    readBtn.removeAttribute('href');
    readBtn.style.display = 'none';
  }

  lockScroll();
  modal.showModal();
}
modal.addEventListener('close', unlockScroll);

/* ====== 7) ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö Realtime ====== */
document.getElementById('q').addEventListener('input', applyFilters);

/* ====== 8) ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ====== */
(async function init(){
  RAW = await loadCSV();
  RAW = RAW.map(r=>({
    id: r.id, title: r.title, year: r.year, era: r.era,
    continent: r.continent, country: r.country || "",
    image: r.image, summary: r.summary, category: r.category, source_url: r.source_url
  }));
  applyFilters();
})();
</script>
</body>
</html>
